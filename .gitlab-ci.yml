# GitLab CI/CD Configuration pour Orchestrator Agent
# Pipeline de test et validation automatique

stages:
  - test
  - validate

variables:
  PYTHON_VERSION: "3.11"

# Job de test des jalons
test_jalons:
  stage: test
  image: python:${PYTHON_VERSION}
  before_script:
    - cd orchestrator_agent_py
    - pip install -r requirements.txt
  script:
    - echo "🧪 Tests du Jalon 1.3 - FastAPI"
    - python debug/test_jalon_1_3_offline.py || echo "Test nécessite serveur démarré"
    - echo "🧪 Tests du Jalon 2.1 - OpenAI Adapter"  
    - python debug/test_jalon_2_1_offline.py
    - echo "🧪 Tests du Jalon 2.2 - Factory & DI"
    - python debug/test_jalon_2_2.py
  artifacts:
    reports:
      junit: orchestrator_agent_py/test-results.xml
    when: always
  only:
    - master
    - develop

# Job de validation de l'architecture
validate_architecture:
  stage: validate
  image: python:${PYTHON_VERSION}
  before_script:
    - cd orchestrator_agent_py
    - pip install -r requirements.txt
  script:
    - echo "🏗️ Validation de l'architecture SOLID"
    - python debug/test_factory_simple.py
    - echo "✅ Architecture validée"
  only:
    - master